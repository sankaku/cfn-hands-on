# CloudFormationの概要

## CloudFormationとは？
CloudFormationはAWSの1サービスであり、AWSのさまざまなリソースをコードとして管理するときに使います。つまりAWS上でIaCを実現するサービスです。

### なぜIaCなのか: Webブラウザから作成する場合との比較
AWSでEC2インスタンスやS3バケットなどのリソースを作成することを考えます。簡単な方法として、WebブラウザでAWSコンソールにログインし、そのリソースの画面からGUIで作成する方法があります。

ですがこの方法では問題がある場合があります。  
たとえば同種のリソースを似た設定でもう一つ作る場合、ブラウザ上で再び同じような操作をしなければなりません。これは手間がかかりますし、その操作がある程度複雑な場合は手順書などが必要でしょう。手順書があっても、それを実行するのは人間であるため、誤って手順書にはない作業をしてしまうかもしれません。  
あるいは、たとえば現在構築されているリソースが、いつどんなふうに変わったか調べようと思った場合、AWSコンソールから調べるのは困難です。  
または、たとえば環境変数だけを変えて、ステージング環境と本番環境にデプロイする場合、ほぼ同じ手順を2回たどるのは退屈だし、ミスも起こります。

このような問題を解決する手段としてIaC(Infrastructure as Code)という考え方があります。これはAWSリソースなどのインフラを、コードで管理しようという考え方です。これにより、インフラはコードで記述されます。  
人がレビュー済み手順書に沿って作業をする代わりに、レビュー済みコードを適用することでインフラが構成されます。そのため、作業者のミスでインフラ構成に失敗することが少なくなります。  
また、WebブラウザでAWSコンソールを見て設定の変遷を調べる代わりに、Git管理したコードで履歴をたどり、いつどんな変更があったかわかります。  
さらに、ほぼ同じ手順をステージング環境と本番環境で2回たどる代わりに、一部の設定だけを変えた同一コードでデプロイできます。

### IaCのツールとしてCloudFormationを選ぶ理由
クラウドサービスのインフラに対し、IaCを実現するためのツールとして[AWS CloudFormation](https://aws.amazon.com/jp/cloudformation/)、[Terraform](https://www.terraform.io/)、[AWS CDK](https://aws.amazon.com/jp/cdk/)などがあります。

今回、CloudFormationを選ぶ理由は以下です。

- AWSの公式サービスであること  
  CloudFormationはAWSが直接サポートしており、各種ドキュメントもAWSがメンテナンスしています。AWSのリソースを扱う場合、AWS内で完結できます。  
  (TerraformはHashiCorp社製です。AWS CDKはAWSのサービスです。)
- 自分でリソース設定を陽的に書くこと  
  これはAWS CDKとの比較です。CDKはAWSのベストプラクティスを **デフォルトで** 使用しています。このため、コードに記述したリソースに加えて、(ちゃんと指定しない場合には)別のリソースが勝手に作成されることがあり、場合によっては大きなお世話です。  
  CloudFormationではすべてのリソースを自分で書くことになるので、記述していないリソースを勝手に作られるということが(たぶん)ありません。ただ、そのぶん記述量は多いです。

## CloudFormationの使い方
CloudFormationを使ってリソースをデプロイする場合、以下のような流れをたどるはずです。

1. 必要なリソースと設定を決める  
   これはこのハンズオンのスコープ外なので略。
1. CloudFormationテンプレートを書く
1. CloudFormationテンプレートを検証する  
   レビューを受ける、linterをかける、…
1. CloudFormationテンプレートで環境にデプロイする

上の手順について、次のページから解説します。
